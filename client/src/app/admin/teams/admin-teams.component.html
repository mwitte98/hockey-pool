<div class="header">
  <h1 class="mat-h1">Admin - Teams</h1>
</div>
<mat-spinner *ngIf="loading"></mat-spinner>
<div class="accordion-container">
  <mat-accordion multi [displayMode]="'flat'">
    <mat-expansion-panel class="expansion-panel" *ngFor="let team of teams; trackBy: trackByTeamId">
      <mat-expansion-panel-header [expandedHeight]="'48px'" class="expansion-panel-header">
        <mat-panel-title>{{ team.name }}</mat-panel-title>
      </mat-expansion-panel-header>
      <ng-template matExpansionPanelContent>
        <div class="expansion-panel-body">
          <form [formGroup]="team.form" (ngSubmit)="updateTeam(team.id)">
            <mat-form-field>
              <mat-label>Team Name</mat-label>
              <input matInput formControlName="name" />
            </mat-form-field>
            <mat-form-field class="abbr-input">
              <mat-label>Abbreviation</mat-label>
              <input
                matInput
                formControlName="abbr"
                minlength="3"
                maxlength="3"
                oninput="let p=this.selectionStart; this.value=this.value.toUpperCase(); this.setSelectionRange(p, p);" />
            </mat-form-field>
            <mat-checkbox formControlName="isEliminated" color="primary">Eliminated</mat-checkbox>
            <mat-checkbox formControlName="madePlayoffs" color="primary">Made Playoffs</mat-checkbox>
            <mat-form-field class="conference-input">
              <mat-label>Conference</mat-label>
              <mat-select formControlName="conference">
                <mat-option value="Eastern">Eastern</mat-option>
                <mat-option value="Western">Western</mat-option>
              </mat-select>
            </mat-form-field>
            <mat-form-field class="number-input">
              <mat-label>Rank</mat-label>
              <input matInput type="number" formControlName="rank" />
            </mat-form-field>
            <mat-form-field class="number-input">
              <mat-label>NHL ID</mat-label>
              <input matInput type="number" formControlName="nhlId" />
            </mat-form-field>
            <button
              mat-raised-button
              class="primary-button"
              color="primary"
              type="submit"
              [disabled]="!team.form.valid || team.updateLoading">
              Update
            </button>
            <div class="form-submit-status">
              <mat-spinner class="form-spinner" *ngIf="team.updateLoading" [diameter]="25"></mat-spinner>
              <mat-icon class="check-icon" *ngIf="team.updateSuccess">check</mat-icon>
              <mat-icon color="warn" *ngIf="team.updateFailure">clear</mat-icon>
            </div>
          </form>
          <form
            [formGroup]="player.form"
            (ngSubmit)="updatePlayer(team.id, player.id)"
            *ngFor="let player of team.players; trackBy: trackByPlayerId">
            <mat-form-field class="player-name-input">
              <mat-label>First Name</mat-label>
              <input matInput formControlName="firstName" />
            </mat-form-field>
            <mat-form-field class="player-name-input">
              <mat-label>Last Name</mat-label>
              <input matInput formControlName="lastName" />
            </mat-form-field>
            <mat-form-field class="position-input">
              <mat-label>Position</mat-label>
              <mat-select formControlName="position">
                <mat-option value="Center">C</mat-option>
                <mat-option value="Winger">W</mat-option>
                <mat-option value="Defenseman">D</mat-option>
                <mat-option value="Goalie">G</mat-option>
              </mat-select>
            </mat-form-field>
            <button
              mat-raised-button
              class="primary-button"
              color="primary"
              type="submit"
              [disabled]="!player.form.valid || player.updateLoading">
              Update
            </button>
            <div class="form-submit-status">
              <mat-spinner class="form-spinner" *ngIf="player.updateLoading" [diameter]="25"></mat-spinner>
              <mat-icon class="check-icon" *ngIf="player.updateSuccess">check</mat-icon>
              <mat-icon color="warn" *ngIf="player.updateFailure">clear</mat-icon>
            </div>
          </form>
        </div>
      </ng-template>
    </mat-expansion-panel>
  </mat-accordion>
</div>
